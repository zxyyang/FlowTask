# 桌面贴图视图切换功能

## 功能概述

为桌面贴图窗口添加了优美的视图切换器，可以在"今日待办"和"全部待办"之间流畅切换，帮助用户更好地管理和查看任务。

## ✨ 功能特性

### 1. 双视图模式

#### 今日待办 📅
- 显示今天需要完成的任务
- 包含今天到期的任务
- 包含今天开始的任务
- 帮助用户专注于当天的工作

#### 全部待办 📋
- 显示所有未完成的任务
- 不限制时间范围
- 查看完整的任务列表
- 适合长期规划

### 2. 优美的切换动画

#### 视觉效果
- **渐变背景**：选中项使用蓝色渐变背景
- **流畅过渡**：使用 `matchedGeometryEffect` 实现平滑的滑动效果
- **阴影效果**：选中项带有柔和的阴影
- **弹簧动画**：切换时使用弹簧动画，更自然

#### 交互反馈
- 点击即可切换
- 选中状态清晰可见
- 图标和文字颜色变化
- 白色文字在蓝色背景上更醒目

### 3. 智能任务过滤

#### 今日任务判断逻辑
```swift
// 任务在今天的条件：
1. 任务未完成
2. 任务有开始时间或截止时间
3. 时间范围与今天有交集
```

#### 过滤规则
- **有开始和结束时间**：任务开始 < 明天 且 任务结束 >= 今天
- **只有一个时间**：该时间在今天
- **没有时间**：不显示在今日视图

### 4. 空状态提示

#### 今日待办为空
- 图标：☀️ 太阳
- 文字："今天没有待办任务"
- 副标题："享受美好的一天吧！"

#### 全部待办为空
- 图标：✓ 对勾
- 文字："没有待办任务"
- 副标题："在下方输入框添加你的第一个任务"

## 🎨 设计细节

### 切换器样式

```
┌─────────────────────────────┐
│  [📅 今日]  [ 📋 全部]     │  ← 未选中：灰色文字
│  ▔▔▔▔▔▔▔▔                  │
└─────────────────────────────┘

┌─────────────────────────────┐
│  [ 📅 今日]  [📋 全部]     │  ← 选中：蓝色渐变背景
│              ▔▔▔▔▔▔▔▔       │
└─────────────────────────────┘
```

### 颜色方案
- **选中背景**：蓝色渐变 (accentColor → accentColor.opacity(0.8))
- **选中文字**：白色
- **未选中文字**：次要颜色 (secondary)
- **容器背景**：控制背景色 (controlBackgroundColor)

### 动画参数
- **弹簧响应**：0.3 秒
- **阻尼系数**：0.7
- **过渡效果**：缩放 + 透明度

## 💡 使用场景

### 场景 1：专注今日工作
1. 切换到"今日"视图
2. 只看到今天需要完成的任务
3. 避免被长期任务干扰
4. 提高当天的执行效率

### 场景 2：查看全部任务
1. 切换到"全部"视图
2. 查看所有未完成的任务
3. 进行长期规划
4. 了解整体工作量

### 场景 3：快速切换
1. 早上查看今日任务
2. 规划时切换到全部任务
3. 执行时切换回今日任务
4. 流畅的切换体验

## 🔧 技术实现

### 1. 视图模式枚举
```swift
enum TaskViewMode: String, CaseIterable {
    case today = "今日"
    case all = "全部"
    
    var icon: String {
        switch self {
        case .today: return "calendar.badge.clock"
        case .all: return "list.bullet"
        }
    }
}
```

### 2. 任务过滤
```swift
private var displayTasks: [FlowTask] {
    switch viewMode {
    case .today:
        return todayTasks
    case .all:
        return pendingTasks
    }
}
```

### 3. 切换器实现
```swift
@Namespace private var namespace

HStack(spacing: 0) {
    ForEach(TaskViewMode.allCases, id: \.self) { mode in
        Button {
            withAnimation(.spring(response: 0.3, dampingFraction: 0.7)) {
                viewMode = mode
            }
        } label: {
            // 按钮内容
        }
        .background(
            if viewMode == mode {
                RoundedRectangle(cornerRadius: 6)
                    .fill(LinearGradient(...))
                    .matchedGeometryEffect(id: "viewMode", in: namespace)
            }
        )
    }
}
```

### 4. 过渡动画
```swift
.transition(.asymmetric(
    insertion: .scale(scale: 0.9).combined(with: .opacity),
    removal: .scale(scale: 0.9).combined(with: .opacity)
))
```

## 📱 界面布局

```
┌─────────────────────────────┐
│  ● ○ ○        Tasks      ↗  │  ← 标题栏
├─────────────────────────────┤
│  [📅 今日]  [ 📋 全部]     │  ← 视图切换器
├─────────────────────────────┤
│                             │
│  ○ 任务 1                   │
│  ○ 任务 2                   │  ← 任务列表
│  ○ 任务 3                   │
│                             │
├─────────────────────────────┤
│  [快速添加任务...]          │  ← 快速添加
└─────────────────────────────┘
```

## 🎯 用户体验优化

### 1. 视觉反馈
- 选中状态清晰明显
- 渐变背景更有质感
- 阴影增加层次感

### 2. 交互流畅
- 弹簧动画自然
- 切换响应迅速
- 过渡效果平滑

### 3. 信息清晰
- 图标辅助识别
- 文字简洁明了
- 空状态有引导

### 4. 性能优化
- 使用 LazyVStack 延迟加载
- 动画使用 GPU 加速
- 状态管理高效

## 🚀 未来扩展

可以考虑添加更多视图模式：

- [ ] **本周待办**：显示本周的任务
- [ ] **重要任务**：显示标记为重要的任务
- [ ] **逾期任务**：显示已经逾期的任务
- [ ] **按项目分组**：按项目或分类显示
- [ ] **自定义筛选**：用户自定义筛选条件

## 📝 注意事项

1. **今日任务判断**：基于任务的开始时间和截止时间
2. **时区处理**：使用系统日历确保时区正确
3. **性能考虑**：任务列表使用 LazyVStack
4. **动画流畅**：使用 matchedGeometryEffect 确保平滑过渡

## 相关文件

- `macOS/Views/StickyWindow/DesktopStickyWindow.swift` - 主要实现文件
  - TaskViewMode 枚举
  - viewModeSwitcher 视图
  - displayTasks 计算属性
  - todayTasks 过滤逻辑

## 效果预览

### 切换动画
1. 点击"全部"按钮
2. 蓝色背景从"今日"滑动到"全部"
3. 任务列表平滑切换
4. 整个过程流畅自然

### 视觉效果
- 渐变蓝色背景
- 柔和的阴影
- 清晰的图标
- 优雅的动画
