# 测试到期提醒跳转功能

## 测试步骤

### 1. 创建一个到期任务

1. 打开 FlowTask 应用
2. 创建一个新任务
3. 设置截止时间为当前时间之前（例如：1分钟前）
4. 保存任务

### 2. 触发到期提醒

1. 等待应用检测到到期任务（最多1分钟）
2. 观察菜单栏是否显示"⚠️ 到期提醒！"

### 3. 测试点击跳转

1. 点击菜单栏的"⚠️ 到期提醒！"
2. 观察以下行为：
   - ✅ 主窗口应该自动打开
   - ✅ 自动切换到"今日"视图
   - ✅ 左侧任务列表中，到期任务应该被选中（高亮显示）
   - ✅ 右侧应该显示该任务的详情
   - ✅ 菜单栏的"⚠️ 到期提醒！"应该消失，恢复正常显示

### 4. 查看控制台日志

如果功能不工作，请查看 Xcode 控制台的日志输出：

```
[AppDelegate] openMainWindowAndShowOverdueTasks 被调用
[AppDelegate] 找到 X 个到期任务
[AppDelegate] 第一个到期任务: XXX
[AppDelegate] 发送 showTaskDetail 通知
[MainContentView] 收到 showTaskDetail 通知，任务: XXX
[MainContentView] 发送 selectTask 通知
[MacTodayView] 收到 selectTask 通知，任务: XXX
[MacTodayView] 已选中任务: XXX
```

## 常见问题排查

### 问题1：点击后没有反应

**可能原因：**
- 任务数据还没有加载完成
- 通知监听器没有正确设置

**解决方法：**
1. 检查控制台是否有 `[AppDelegate] openMainWindowAndShowOverdueTasks 被调用` 日志
2. 如果没有，说明点击事件没有被触发
3. 如果有，继续查看后续日志

### 问题2：窗口打开了但没有选中任务

**可能原因：**
- 任务不在"今日"视图中
- 通知传递失败

**解决方法：**
1. 检查控制台是否有 `[MainContentView] 收到 showTaskDetail 通知` 日志
2. 检查任务是否真的在"今日"视图中（有截止时间且是今天或之前）
3. 手动切换到"今日"视图，看看任务是否在列表中

### 问题3：任务在列表中但没有被选中

**可能原因：**
- selectTask 通知没有被接收
- 任务 ID 不匹配

**解决方法：**
1. 检查控制台是否有 `[MacTodayView] 收到 selectTask 通知` 日志
2. 检查任务 ID 是否正确
3. 确认 MacTodayView 的 onAppear 被调用了

## 手动测试命令

如果需要手动触发通知进行测试，可以在代码中添加：

```swift
// 在任意地方调用
NotificationCenter.default.post(
    name: .showTaskDetail,
    object: nil,
    userInfo: ["taskId": "你的任务ID"]
)
```

## 预期行为总结

1. **点击前**：菜单栏显示"⚠️ 到期提醒！"
2. **点击时**：不显示菜单，直接执行跳转
3. **跳转后**：
   - 主窗口打开
   - 切换到"今日"视图
   - 选中第一个到期任务
   - 显示任务详情
   - 菜单栏恢复正常显示

## 调试技巧

1. **启用详细日志**：所有关键步骤都有 print 日志
2. **检查任务数据**：确认任务确实到期了
3. **检查视图状态**：确认"今日"视图中有该任务
4. **逐步测试**：先测试窗口打开，再测试视图切换，最后测试任务选中

## 成功标志

当你看到以下所有现象时，说明功能正常工作：

- ✅ 控制台有完整的日志输出
- ✅ 主窗口自动打开
- ✅ "今日"标签被选中
- ✅ 任务列表中的到期任务被高亮
- ✅ 右侧显示任务详情
- ✅ 菜单栏提醒消失
